<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The **DEVIL** is in the **DETAILS**. Step-by-step detailed How To Guides for data management and other CCBR-relevant tasks."><meta name=author content="Vishal Koparde, Ph.D."><link href=../setup/ rel=prev><link href=../../UCSC/overview/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.6"><title>Biowulf2HPCDME - CCBR How Tos</title><link rel=stylesheet href=../../assets/stylesheets/main.558e4712.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#background class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="CCBR How Tos" class="md-header__button md-logo" aria-label="CCBR How Tos" data-md-component=logo> <img src=../../assets/images/doc-book.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> CCBR How Tos </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Biowulf2HPCDME </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/CCBR/HowTos title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> CCBR/HowTos </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Intro </a> </li> <li class=md-tabs__item> <a href=../../GitHub/overview/ class=md-tabs__link> GitHub </a> </li> <li class=md-tabs__item> <a href=../setup/ class="md-tabs__link md-tabs__link--active"> HPCDME </a> </li> <li class=md-tabs__item> <a href=../../UCSC/overview/ class=md-tabs__link> UCSC Tracks </a> </li> <li class=md-tabs__item> <a href=../../Tutorials/summary/ class=md-tabs__link> Tutorials </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="CCBR How Tos" class="md-nav__button md-logo" aria-label="CCBR How Tos" data-md-component=logo> <img src=../../assets/images/doc-book.svg alt=logo> </a> CCBR How Tos </label> <div class=md-nav__source> <a href=https://github.com/CCBR/HowTos title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> CCBR/HowTos </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Intro </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 tabindex=0 aria-expanded=false> GitHub <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=GitHub data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> GitHub </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../GitHub/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../GitHub/setup_env/ class=md-nav__link> Preparing your environment </a> </li> <li class=md-nav__item> <a href=../../GitHub/setup_repo/ class=md-nav__link> Creating your GitHub repo </a> </li> <li class=md-nav__item> <a href=../../GitHub/sop_repo/ class=md-nav__link> Repository Management </a> </li> <li class=md-nav__item> <a href=../../GitHub/sop_docs/ class=md-nav__link> Documentation </a> </li> <li class=md-nav__item> <a href=../../GitHub/sop_actions/ class=md-nav__link> GitHub Actions </a> </li> <li class=md-nav__item> <a href=../../GitHub/sop_testdata/ class=md-nav__link> Test Data </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 tabindex=0 aria-expanded=true> HPCDME <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=HPCDME data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> HPCDME </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../setup/ class=md-nav__link> Setup </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Biowulf2HPCDME <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Biowulf2HPCDME </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#background class=md-nav__link> Background </a> <nav class=md-nav aria-label=Background> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-tarball class=md-nav__link> Create tarball </a> </li> <li class=md-nav__item> <a href=#create-filelist class=md-nav__link> Create filelist </a> </li> <li class=md-nav__item> <a href=#create-project class=md-nav__link> Create Project </a> </li> <li class=md-nav__item> <a href=#create-analysis class=md-nav__link> Create Analysis </a> </li> <li class=md-nav__item> <a href=#create-metadata class=md-nav__link> Create metadata </a> </li> <li class=md-nav__item> <a href=#transfer class=md-nav__link> Transfer </a> </li> <li class=md-nav__item> <a href=#cleanup class=md-nav__link> Cleanup </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 tabindex=0 aria-expanded=false> UCSC Tracks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="UCSC Tracks" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> UCSC Tracks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../UCSC/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../UCSC/creating_inputs/ class=md-nav__link> Creating Inputs </a> </li> <li class=md-nav__item> <a href=../../UCSC/creating_track_info/ class=md-nav__link> Creating Tracks Info </a> </li> <li class=md-nav__item> <a href=../../UCSC/creating_tracks/ class=md-nav__link> Creating Tracks </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 tabindex=0 aria-expanded=false> Tutorials <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tutorials data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Tutorials/summary/ class=md-nav__link> Summary </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Biowulf2HPCDME</h1> <h3 id=background>Background<a class=headerlink href=#background title="Permanent link">&para;</a></h3> <p>Rawdata or Project folders from Biowulf can be parked at a secure location after the analysis has reached a endpoint. Traditionally, CCBR analysts had access to the GridFTP Globus Archive for doing this. But, this Globus Archive has been running past 95% full lately.</p> <p>This document outlines how a projects folder can be directly parked on HPCDME as a single "tar.gz" ball. It is assumed that HPC DME API CLUs are already setup as per <a href=https://ccbr.github.io/HowTos/HPCDME/setup/ >these</a> instructions.</p> <p>Here are the steps:</p> <h4 id=create-tarball>Create tarball<a class=headerlink href=#create-tarball title="Permanent link">&para;</a></h4> <p>Once you have a list of files that you want to include in the tarball, create the tarball. This may take a while and should be submitted as a slurm job.</p> <div class=highlight><pre><span></span><code>%<span class=w> </span><span class=nb>cd</span><span class=w> </span>/data/CCBR/projects
%<span class=w> </span>du<span class=w> </span>-hs<span class=w> </span>/data/CCBR/projects/ccbr796
440G<span class=w>    </span>/data/CCBR/projects/ccbr796
%<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;tar czvf ccbr796.tar.gz /data/CCBR/projects/ccbr796&quot;</span><span class=w> </span>&gt;<span class=w> </span>do_tar_gz
%<span class=w> </span>swarm<span class=w> </span>-f<span class=w> </span>do_tar_gz<span class=w> </span>--partition<span class=o>=</span>ccr,norm<span class=w> </span>--time<span class=o>=</span><span class=m>24</span>:00:00<span class=w> </span>-t<span class=w> </span><span class=m>2</span><span class=w> </span>-g<span class=w> </span><span class=m>100</span>
<span class=m>41985209</span>
</code></pre></div> <h4 id=create-filelist>Create filelist<a class=headerlink href=#create-filelist title="Permanent link">&para;</a></h4> <p>Sometime you just want to know what files are in the tarball. Hence, it is important to upload a filelist along with the tarball.</p> <div class=highlight><pre><span></span><code>%<span class=w> </span>tar<span class=w> </span>tzvf<span class=w> </span>ccbr796.tar.gz<span class=w> </span>&gt;<span class=w> </span>ccbr796.tar.gz.filelist
</code></pre></div> <h4 id=create-project>Create Project<a class=headerlink href=#create-project title="Permanent link">&para;</a></h4> <p>If the Project collection does not exist in HPCDME (verify using the web interface), then you may need to create it.</p> <div class=highlight><pre><span></span><code>%<span class=w> </span><span class=nb>cd</span><span class=w> </span>/data/kopardevn/SandBox/parkit
%<span class=w> </span>bash<span class=w> </span>create_empty_project_collection.sh<span class=w> </span>/CCBR_Archive/GRIDFTP/Project_CCBR-796<span class=w> </span>CCBR-796<span class=w> </span>CCBR-796
<span class=o>{</span>
<span class=w>    </span><span class=s2>&quot;metadataEntries&quot;</span>:<span class=w> </span><span class=o>[</span>
<span class=w>        </span><span class=o>{</span>
<span class=w>         </span><span class=s2>&quot;attribute&quot;</span>:<span class=w> </span><span class=s2>&quot;collection_type&quot;</span>,
<span class=w>         </span><span class=s2>&quot;value&quot;</span>:<span class=w> </span><span class=s2>&quot;Project&quot;</span>
<span class=w>        </span><span class=o>}</span>,
<span class=w>        </span><span class=o>{</span>
<span class=w>         </span><span class=s2>&quot;attribute&quot;</span>:<span class=w> </span><span class=s2>&quot;project_start_date&quot;</span>,
<span class=w>         </span><span class=s2>&quot;value&quot;</span>:<span class=w> </span><span class=s2>&quot;20220616&quot;</span>,
<span class=w>         </span><span class=s2>&quot;dateFormat&quot;</span>:<span class=w> </span><span class=s2>&quot;yyyyMMdd&quot;</span>
<span class=w>        </span><span class=o>}</span>,
<span class=w>        </span><span class=o>{</span>
<span class=w>         </span><span class=s2>&quot;attribute&quot;</span>:<span class=w> </span><span class=s2>&quot;access&quot;</span>,
<span class=w>         </span><span class=s2>&quot;value&quot;</span>:<span class=w> </span><span class=s2>&quot;Open Access&quot;</span>
<span class=w>        </span><span class=o>}</span>,
<span class=w>        </span><span class=o>{</span>
<span class=w>         </span><span class=s2>&quot;attribute&quot;</span>:<span class=w> </span><span class=s2>&quot;method&quot;</span>,
<span class=w>         </span><span class=s2>&quot;value&quot;</span>:<span class=w> </span><span class=s2>&quot;NGS&quot;</span>
<span class=w>        </span><span class=o>}</span>,
<span class=w>        </span><span class=o>{</span>
<span class=w>         </span><span class=s2>&quot;attribute&quot;</span>:<span class=w> </span><span class=s2>&quot;origin&quot;</span>,
<span class=w>         </span><span class=s2>&quot;value&quot;</span>:<span class=w> </span><span class=s2>&quot;CCBR&quot;</span>
<span class=w>        </span><span class=o>}</span>,
<span class=w>        </span><span class=o>{</span>
<span class=w>         </span><span class=s2>&quot;attribute&quot;</span>:<span class=w> </span><span class=s2>&quot;project_affiliation&quot;</span>,
<span class=w>         </span><span class=s2>&quot;value&quot;</span>:<span class=w> </span><span class=s2>&quot;CCBR&quot;</span>
<span class=w>        </span><span class=o>}</span>,
<span class=w>        </span><span class=o>{</span>
<span class=w>         </span><span class=s2>&quot;attribute&quot;</span>:<span class=w> </span><span class=s2>&quot;project_description&quot;</span>,
<span class=w>         </span><span class=s2>&quot;value&quot;</span>:<span class=w> </span><span class=s2>&quot;CCBR-796&quot;</span>
<span class=w>        </span><span class=o>}</span>,
<span class=w>        </span><span class=o>{</span>
<span class=w>         </span><span class=s2>&quot;attribute&quot;</span>:<span class=w> </span><span class=s2>&quot;project_status&quot;</span>,
<span class=w>         </span><span class=s2>&quot;value&quot;</span>:<span class=w> </span><span class=s2>&quot;Completed&quot;</span>
<span class=w>        </span><span class=o>}</span>,
<span class=w>        </span><span class=o>{</span>
<span class=w>         </span><span class=s2>&quot;attribute&quot;</span>:<span class=w> </span><span class=s2>&quot;retention_years&quot;</span>,
<span class=w>         </span><span class=s2>&quot;value&quot;</span>:<span class=w> </span><span class=s2>&quot;7&quot;</span>
<span class=w>        </span><span class=o>}</span>,
<span class=w>        </span><span class=o>{</span>
<span class=w>         </span><span class=s2>&quot;attribute&quot;</span>:<span class=w> </span><span class=s2>&quot;project_title&quot;</span>,
<span class=w>         </span><span class=s2>&quot;value&quot;</span>:<span class=w> </span><span class=s2>&quot;CCBR-796&quot;</span>
<span class=w>        </span><span class=o>}</span>,
<span class=w>        </span><span class=o>{</span>
<span class=w>         </span><span class=s2>&quot;attribute&quot;</span>:<span class=w> </span><span class=s2>&quot;summary_of_samples&quot;</span>,
<span class=w>         </span><span class=s2>&quot;value&quot;</span>:<span class=w> </span><span class=s2>&quot;Unknown&quot;</span>
<span class=w>        </span><span class=o>}</span>,
<span class=w>        </span><span class=o>{</span>
<span class=w>         </span><span class=s2>&quot;attribute&quot;</span>:<span class=w> </span><span class=s2>&quot;organism&quot;</span>,
<span class=w>         </span><span class=s2>&quot;value&quot;</span>:<span class=w> </span><span class=s2>&quot;Unknown&quot;</span>
<span class=w>        </span><span class=o>}</span>
<span class=w>    </span><span class=o>]</span>
<span class=o>}</span>
dm_register_collection<span class=w> </span>/dev/shm/Project_CCBR-796.metadata.json<span class=w> </span>/CCBR_Archive/GRIDFTP/Project_CCBR-796
</code></pre></div> <blockquote> <p><strong>Error</strong>: Have encountered this error message: <div class=highlight><pre><span></span><code>Error<span class=w> </span>during<span class=w> </span>registration,<span class=w> </span>HTTP_CODE:<span class=w> </span><span class=m>503</span>
Cannot<span class=w> </span>find<span class=w> </span>the<span class=w> </span>response<span class=w> </span>message<span class=w> </span>file
collection-registration-response-message.json.tmp
</code></pre></div> 503 error means that the API is down!</p> </blockquote> <h4 id=create-analysis>Create Analysis<a class=headerlink href=#create-analysis title="Permanent link">&para;</a></h4> <p>If the Analysis collection does not exist in HPCDME (verify using the web interface) under the Project collection, then you may need to create it.</p> <div class=highlight><pre><span></span><code>%<span class=w> </span><span class=nb>cd</span><span class=w> </span>/data/kopardevn/SandBox/parkit
%<span class=w> </span>bash<span class=w> </span>create_empty_analysis_collection.sh<span class=w> </span>/CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis
dm_register_collection<span class=w> </span>/dev/shm/Analysis.metadata.json<span class=w> </span>/CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis
</code></pre></div> <p>Done! Now you have a location ready for the the tarball to be parked.</p> <h4 id=create-metadata>Create metadata<a class=headerlink href=#create-metadata title="Permanent link">&para;</a></h4> <p>Using <code>meta</code> script from <a href=https://github.com/CCBR/pyrkit><code>pyrkit</code></a>, we can then generate the required <code>.metadata.json</code> file for the tarball. Analysis collection <code>/CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis</code> should already exist in the HPCDME vault.</p> <div class=highlight><pre><span></span><code>%<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;/data/kopardevn/SandBox/pyrkit/src/meta combined --input /data/CCBR/projects/ccbr796.tar.gz --output /CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis&quot;</span><span class=w> </span>&gt;<span class=w> </span>do_get_metadata
%<span class=w> </span>swarm<span class=w> </span>-f<span class=w> </span>do_get_metadata<span class=w> </span>--partition<span class=o>=</span>ccr,norm<span class=w> </span>--time<span class=o>=</span><span class=m>24</span>:00:00<span class=w> </span>-t<span class=w> </span><span class=m>2</span><span class=w> </span>-g<span class=w> </span><span class=m>100</span>
</code></pre></div> <p>If the file is large (100s of GB), then this may take a while as the md5sum of the file is being calculated. Hence, this should be submitted to the slurm. </p> <p>Metadata also needs to be created for the filelist file. These files are generally small (few MBs) and the following command can be directly run on an interactive node.</p> <div class=highlight><pre><span></span><code>%<span class=w> </span>/data/kopardevn/SandBox/pyrkit/src/meta<span class=w> </span>combined<span class=w> </span>--input<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz.filelist<span class=w> </span>--output<span class=w> </span>/CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis
</code></pre></div> <p>The above command, when run sucessfully, will create <code>/data/CCBR/projects/ccbr796.tar.gz.filelist.metadata.json</code></p> <h4 id=transfer>Transfer<a class=headerlink href=#transfer title="Permanent link">&para;</a></h4> <p><code>dm_register_dataobject</code> cannot be used for large files (&gt;10GB), but it can be replaced by <code>dm_register_dataobject_multipart</code></p> <div class=highlight><pre><span></span><code>%<span class=w> </span>dm_register_dataobject_multipart<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz.metadata.json<span class=w> </span>/CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis/ccbr796.tar.gz<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz
Reading<span class=w> </span>properties<span class=w> </span>from<span class=w> </span>/data/kopardevn/SandBox/HPC_DME_APIs/utils/hpcdme.properties
Registering<span class=w> </span>file:<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz
Destination<span class=w> </span>archive<span class=w> </span>path:<span class=w> </span>/CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis/ccbr796.tar.gz
Cmd<span class=w> </span>process<span class=w> </span>Completed
Jun<span class=w> </span><span class=m>16</span>,<span class=w> </span><span class=m>2022</span><span class=w> </span><span class=m>10</span>:55:25<span class=w> </span>AM<span class=w> </span>org.springframework.shell.core.AbstractShell<span class=w> </span>handleExecutionResult
INFO:<span class=w> </span>CLI_SUCCESS
</code></pre></div> <p>Depending on the size of the file, this step can be done in a reasonable amount of time (&lt;1hr) and can be run in an interactive node.</p> <p>Remember, the filelist file also needs to be registered separately like this:</p> <div class=highlight><pre><span></span><code>%<span class=w> </span>dm_register_dataobject<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz.filelist.metadata.json<span class=w> </span>/CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis/ccbr796.tar.gz.filelist<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz.filelist
</code></pre></div> <p>As filelist files are smaller (few MBs), we can run <code>dm_register_dataobject</code> in place of <code>dm_register_dataobject_multipart</code>.</p> <h4 id=cleanup>Cleanup<a class=headerlink href=#cleanup title="Permanent link">&para;</a></h4> <p>Once the tarball is successfully transferred over the HPCDME, it can be deleted from the local filesystem.</p> <div class=highlight><pre><span></span><code>%<span class=w> </span>rm<span class=w> </span>-f<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz
</code></pre></div> <p>The contents of the local analysis folder can also be deleted.</p> <div class=highlight><pre><span></span><code>%<span class=w> </span><span class=nb>cd</span><span class=w> </span>/data/CCBR/projects/ccbr796<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>*
</code></pre></div> <p>A note can be added to the recently emptied folder stating where the contents are currently parked.</p> <div class=highlight><pre><span></span><code>%<span class=w> </span><span class=nb>cd</span><span class=w> </span>/data/CCBR/projects/ccbr796
%<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;This folder was converted to a tarball (tar.gz) and pushed to HPCDME. Its new location is \`/CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis/ccbr796.tar.gz\` in HPCDME&quot;</span><span class=w> </span>&gt;<span class=w> </span>README.md
</code></pre></div> <p>Done!</p> <blockquote> <p><strong>NOTE FOR LARGE FILES</strong>: It is recommended by HPCDME staff that files to be transferred should not be too large (1TB or smaller). Hence, if the file to be transferred is larger than 1TB, it should be split into 1TB-size chunks and upload those. Splitting can be done like this: <div class=highlight><pre><span></span><code>split<span class=w> </span>-b<span class=w> </span>1T<span class=w> </span>ccbr796.tar.gz<span class=w> </span><span class=s2>&quot;ccbr796.tar.gz.part_&quot;</span>
</code></pre></div> Metadata needs to be individidually created for each of the parts, namely, <code>ccbr796.tar.gz.part_aa</code>, <code>ccbr796.tar.gz.part_ab</code>, etc <div class=highlight><pre><span></span><code>%<span class=w> </span>/data/kopardevn/SandBox/pyrkit/src/meta<span class=w> </span>combined<span class=w> </span>--input<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz.part_aa<span class=w> </span>--output<span class=w> </span>/CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis
%<span class=w> </span>/data/kopardevn/SandBox/pyrkit/src/meta<span class=w> </span>combined<span class=w> </span>--input<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz.part_ab<span class=w> </span>--output<span class=w> </span>/CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis
...
</code></pre></div> Next each 1TB part can be registered like so: <div class=highlight><pre><span></span><code>%<span class=w> </span>dm_register_dataobject_multipart<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz.part_aa.metadata.json<span class=w> </span>/CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis/ccbr796.tar.gz.part_aa<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz.part_aa
%<span class=w> </span>dm_register_dataobject_multipart<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz.part_ab.metadata.json<span class=w> </span>/CCBR_Archive/GRIDFTP/Project_CCBR-796/Analysis/ccbr796.tar.gz.part_ab<span class=w> </span>/data/CCBR/projects/ccbr796.tar.gz.part_ab
...
</code></pre></div> Once these files are downloaded then can be joined together using the <code>cat</code> command before ungzipping/untaring. <div class=highlight><pre><span></span><code>%<span class=w> </span>cat<span class=w> </span>ccbr796.tar.gz.part_*<span class=w> </span>&gt;<span class=w> </span>ccbr796.tar.gz
</code></pre></div></p> </blockquote> <hr> <div class=md-source-file> <small> Last update: 2023-04-14 </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2022 CCBR </div> </div> <div class=md-social> <a href=https://ccbr.ccr.cancer.gov/ target=_blank rel=noopener title=ccbr.ccr.cancer.gov class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M144 160c-44.2 0-80-35.8-80-80S99.8 0 144 0s80 35.8 80 80-35.8 80-80 80zm368 0c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80zM0 298.7C0 239.8 47.8 192 106.7 192h42.7c15.9 0 31 3.5 44.6 9.7-1.3 7.2-1.9 14.7-1.9 22.3 0 38.2 16.8 72.5 43.3 96H21.3C9.6 320 0 310.4 0 298.7zM405.3 320h-.7c26.6-23.5 43.3-57.8 43.3-96 0-7.6-.7-15-1.9-22.3 13.6-6.3 28.7-9.7 44.6-9.7h42.7c58.9 0 106.7 47.8 106.7 106.7 0 11.8-9.6 21.3-21.3 21.3H405.3zm10.7-96c0 53-43 96-96 96s-96-43-96-96 43-96 96-96 96 43 96 96zM128 485.3c0-73.6 59.7-133.3 133.3-133.3h117.4c73.6 0 133.3 59.7 133.3 133.3 0 14.7-11.9 26.7-26.7 26.7H154.7c-14.7 0-26.7-11.9-26.7-26.7z"/></svg> </a> <a href=https://github.com/CCBR target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=mailto:vishal.koparde@nih.gov target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.top", "navigation.indexes", "toc.integrate"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.51d95adb.min.js></script> </body> </html>